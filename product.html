<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Produkt ‚Äì Mays</title>

  <!-- Tailwind (nur Utility; Design ist unten im <style>) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Dein globales CSS (wenn vorhanden) -->
  <link rel="stylesheet" href="./style.css">

  <!-- Seitenspezifische Erg√§nzungen -->
  <style>
    :root{
      --pink:#ec4899;
      --pink-strong:#db2777;
      --ring: rgba(236,72,153,.25);
    }

    /* Buttons / Tabs */
    .btn{padding:.6rem 1rem;border-radius:12px;background:var(--pink);color:#fff;transition:all .18s ease;}
    .btn:hover{background:var(--pink-strong);}
    .btn:active{transform:translateY(1px);}
    .tab-btn{padding:.45rem .8rem;border-radius:.7rem;transition:.18s;}
    .tab-btn.active{background:#fce7f3;color:#be185d;font-weight:700;}

    /* Galerie / Thumbs */
    .image-zoom{position:relative;border-radius:1rem;overflow:hidden;}
    .image-zoom img{width:100%;height:auto;display:block;user-select:none;-webkit-user-drag:none;}
    #heroImg{display:block;margin:0 auto;}
    .hero-nav{position:absolute;top:50%;transform:translateY(-50%);background:rgba(255,255,255,.9);border:1px solid #e5e7eb;border-radius:999px;width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:20px;line-height:0;box-shadow:0 2px 8px rgba(0,0,0,.08);}
/* ... rest of the CSS in this <style> is unchanged from your original ... */
    .hero-nav.left{left:.5rem;}
    .hero-nav.right{right:.5rem;}
    .hero-nav:hover{background:#fff;}
    .thumbs{display:flex;gap:.5rem;margin-top:.75rem;flex-wrap:wrap;}
    .thumb{border:1px solid #e5e7eb;border-radius:.6rem;overflow:hidden;background:#fff;transition:box-shadow .18s ease;}
    .thumb.active{outline:2px solid var(--pink);}
    .thumb:hover{box-shadow:0 4px 10px rgba(0,0,0,.06);}
    .thumb img{width:64px;height:64px;object-fit:cover;display:block;}

    /* Menge */
    .qty-wrap{display:inline-flex;align-items:center;background:#fff;border:1px solid #f3d1dc;border-radius:999px;overflow:hidden;box-shadow:0 2px 6px rgba(236,72,153,.1);}
    .qty-btn{width:40px;height:40px;border:0;background:#fff;color:var(--pink);font-size:22px;font-weight:500;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease;}
    .qty-btn:hover{background:#ffe4ef;color:var(--pink-strong);transform:scale(1.08);}
    .qty-input{width:64px;text-align:center;border:0;border-left:1px solid #fce7f3;border-right:1px solid #fce7f3;background:#fff;font-size:16px;padding:.4rem 0;color:#333;-webkit-appearance:textfield;-moz-appearance:textfield;appearance:textfield;}
    .qty-input::-webkit-outer-spin-button,.qty-input::-webkit-inner-spin-button{ -webkit-appearance: none; margin: 0; }

    /* Packung */
    .pack-row{display:grid;grid-template-columns: auto minmax(0, 1fr) auto;gap:.75rem;align-items:center;}
    .pack-row--lg{grid-template-columns: 90px minmax(0, 1fr) auto;}
    .pack-label{font-weight:700;color:#7a123f;}
    .select-pink{position:relative;}
    .select-pink select{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:100%;padding:.9rem 2.4rem .9rem 1rem;border:1px solid var(--pink);border-radius:.8rem;background:#ffeaf2;font-size:1rem;font-weight:600;outline:none;color:#111;transition:all .2s ease;}
    .select-pink select:focus{box-shadow:0 0 0 4px var(--ring);background:#fff5f9;border-color:var(--pink);}
    .select-pink::after{content:"‚ñæ";position:absolute;right:.9rem;top:50%;transform:translateY(-50%);pointer-events:none;font-weight:700;color:var(--pink);}
    .pack-price{font-weight:800;color:#7a123f;white-space:nowrap;padding:.25rem .6rem;border-radius:.6rem;background:#fff;border:1px dashed #f9c7dc;}

    /* Preiszeile */
    .price-range{background:transparent;border:none;color:#222;font-weight:800;font-size:1.1rem;}
    .price-range .current{color:var(--pink);}

    /* Divider + Buy Button */
    .section-divider{height:1px;background:#f8cce0;border:none;margin:1.4rem 0;}
    .btn-buy{background:var(--pink);color:#fff;font-weight:800;padding:.95rem 1.4rem;border-radius:.9rem;transition:.2s;box-shadow: 0 6px 18px rgba(236,72,153,.25);}
    .btn-buy[aria-disabled="true"]{opacity:.6;cursor:not-allowed;box-shadow:none;}
    .btn-buy:hover:not([aria-disabled="true"]){background:var(--pink-strong);transform:translateY(-1px);}

    /* Grid */
    .cols-115{grid-template-columns:1.15fr 1fr;}
    @media (max-width: 900px){ .cols-115{grid-template-columns:1fr;} }

    /* Lightbox */
    .lb{position:fixed;inset:0;background:rgba(255,255,255,0.18)!important;backdrop-filter:blur(2px);display:none;cursor:zoom-out;}
    .lb.open{display:block;}
    .lb-box{position:absolute;inset:0;display:grid;place-items:center;padding:28px;pointer-events:none;}
    .lb-stage{
      position:relative;width:min(1100px,92vw);height:min(78vh,800px);
      background:transparent;box-shadow:none;border-radius:14px;overflow:hidden;pointer-events:auto;
      display:flex;align-items:center;justify-content:center;
      --imgW: 600px; --gap: 12px;
    }
    .lb-img{max-width:100%;max-height:100%;display:block;border:8px solid #fff;border-radius:12px;box-shadow:0 12px 36px rgba(0,0,0,.18);transform-origin:center center;transition:transform .05s linear;}
    .lb-nav{position:absolute;top:50%;transform:translateY(-50%);background:#fff!important;color:var(--pink)!important;border:2px solid #fff!important;border-radius:999px;width:42px;height:42px;display:flex;align-items:center;justify-content:center;font-size:22px;box-shadow:0 4px 10px rgba(0,0,0,0.15);transition:all .2s ease;pointer-events:auto;z-index:5;}
    .lb-nav:hover,.lb-nav:active{background:var(--pink)!important;color:#fff!important;border-color:var(--pink)!important;transform:translateY(-50%) scale(1.08);}
    .lb-nav.left  { left: calc(50% - var(--imgW)/2 - var(--gap)) !important; }
    .lb-nav.right { left: calc(50% + var(--imgW)/2 + var(--gap)) !important; }

    /* Animations */
    .hero-animate{animation:heroFade .22s ease;}
    @keyframes heroFade{from{opacity:0;transform:scale(.985);}to{opacity:1;transform:scale(1);}}
    .lb-open-anim{animation:lbPop .18s ease-out;}
    @keyframes lbPop{from{opacity:0;transform:scale(.98);}to{opacity:1;transform:scale(1);}}

    /* Karten (wiederverwendet) */
    .related-card{display:block;border:1px solid #f3d1dc;border-radius:1rem;overflow:hidden;background:#fff;transition:transform .12s ease, box-shadow .12s ease;}
    .related-card:hover{transform:translateY(-2px);box-shadow:0 10px 22px rgba(236,72,153,.12);}
    .rel-img{aspect-ratio:1/1;background:#fff;display:grid;place-items:center;overflow:hidden;}
    .rel-img img{width:100%;height:100%;object-fit:cover;display:block;}
    .rel-txt{padding:.6rem .8rem;}
    .rel-name{font-weight:700;line-height:1.2;}
    .rel-price{color:#7a123f;font-weight:800;margin-top:.2rem;}

    /* ===== Related: Carousel + Card-Details ===== */
    .rel-viewport{overflow:hidden; position:relative}
    .rel-track{
      display:flex; gap:16px; scroll-behavior:smooth; overflow-x:auto;
      padding-bottom:.25rem; -webkit-overflow-scrolling:touch; scrollbar-width:none;
    }
    .rel-track::-webkit-scrollbar{display:none}
    .rel-btn{
      width:38px;height:38px;border-radius:999px;border:1px solid #f3d1dc;
      background:#fff;color:#db2777;font-weight:800;line-height:0;
      box-shadow:0 3px 10px rgba(236,72,153,.12);
      transition:.15s; display:grid; place-items:center;
    }
    .rel-btn:hover{transform:translateY(-1px); background:#fff0f6}
    .rel-btn[disabled]{opacity:.5; cursor:not-allowed; transform:none}
    .related-card{ width:260px; flex:0 0 auto }
    @media (max-width: 480px){ .related-card{ width:78vw } }
    .rel-meta{font-size:.85rem; color:#6b7280; margin-top:.1rem}
    .rel-stars{color:#f59e0b; letter-spacing:.1em; font-size:.9rem}
    .rel-actions{display:flex; align-items:center; justify-content:space-between; gap:.5rem; margin-top:.5rem}
    .btn-mini{
      padding:.45rem .7rem; border-radius:.6rem; background:var(--pink);
      color:#fff; font-weight:700; transition:.15s; white-space:nowrap;
    }
    .btn-mini:hover{ background:var(--pink-strong) }

    /* kleine Tweaks */
    .p-head .p-price{font-size:1.35rem;line-height:1.25}
    #packRow.open{margin-bottom:120px}
/* ===== FINAL FIX: Button minimal nach links (Mobile) ===== */
@media (max-width: 640px) {

  .p-buyrow {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }

  #addBtn {
    width: 100%;
    max-width: 360px;
    position: relative;
    left: -55px; /* üëà HIER passiert die Verschiebung */
  }

}


  </style>
</head>
<body class="min-h-screen bg-pink-50">


  <!-- Header -->
<div class="bg-white border-b border-gray-100">
  <header class="relative max-w-7xl mx-auto px-4 h-16">

    <!-- Zur√ºck (links) -->
    <button
      onclick="history.back()"
      class="absolute left-4 top-1/2 -translate-y-1/2 text-pink-600 hover:underline"
    >
      Zur√ºck
    </button>

    <!-- Logo (Mitte, immer!) -->
    <a
      href="./index.html"
      class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2"
    >
      <img
        src="./images/mays.png"
        alt="Mays Logo"
        class="h-12 w-auto object-contain"
      />
    </a>

    <!-- Warenkorb (RECHTS, FEST) -->
    <a
      href="./cart.html"
      class="cart-btn absolute right-4 top-1/2 -translate-y-1/2 p-2 rounded-full hover:bg-pink-50 border border-pink-200"
    >
      <svg
        class="h-6 w-6 text-gray-800"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <path d="M3 3h2l2.2 10.5a2 2 0 0 0 2 1.5h8.6a2 2 0 0 0 2-1.6l1.1-6.4H6.1"/>
        <circle cx="9" cy="20" r="1.6"/>
        <circle cx="18" cy="20" r="1.6"/>
      </svg>

      <span
        id="cartBadge"
        class="absolute -top-1 -right-1 text-[11px] bg-pink-500 text-white rounded-full px-1.5 py-0.5"
      >
        2
      </span>
    </a>

  </header>
</div>


  <!-- Root -->
  <main class="max-w-7xl mx-auto px-4 py-2" id="root"></main>

  <!-- Lightbox -->
  <div id="lightbox" class="lb" aria-hidden="true">
    <div class="lb-box" id="lbBox">
      <div class="lb-stage" id="lbStage">
        <button class="lb-nav left" id="lbPrev" type="button" aria-label="Vorheriges">‚Äπ</button>
        <img id="lbImg" class="lb-img" src="" alt="">
        <button class="lb-nav right" id="lbNext" type="button" aria-label="N√§chstes">‚Ä∫</button>
      </div>
    </div>
  </div>

  <!-- Seite-Logik -->
  <script>
  (async function(){
    const fmt = c => (c/100).toFixed(2).replace(".", ",") + " ‚Ç¨";

    // Produkte laden (wenn nicht global gesetzt)
    if(!Array.isArray(window.MAYS_PRODUCTS) || !window.MAYS_PRODUCTS.length){
      try{
        const r = await fetch('./products.json', { cache: 'no-cache' });
        window.MAYS_PRODUCTS = await r.json();
      }catch{
        document.getElementById("root").innerHTML =
          '<div class="bg-white rounded-2xl p-6">Fehler beim Laden.</div>';
        return;
      }
    }
    const PRODUCTS = window.MAYS_PRODUCTS || [];

    // Produkt w√§hlen
const rawId = new URLSearchParams(location.search).get("id");
const id = rawId?.split("__")[0];
const product = PRODUCTS.find(p => p.id === id);
    if(!product){
      document.getElementById("root").innerHTML =
        '<div class="bg-white rounded-2xl p-6">Produkt nicht gefunden.</div>';
      return;
    }
    document.title = product.name + " ‚Äì Mays";

    const images = (product.images && product.images.length) ? product.images : ["./images/mays.png"];
    const desc    = product.description || "Beschreibung folgt.";
    const details = Array.isArray(product.details) ? product.details : [];

    // Helpers
    const renderThumbs = (arr,name)=> arr.map((src,i)=>
      '<button class="thumb ' + (i===0?'active':'') + '" data-src="' + src + '" data-idx="' + i + '">' +
        '<img src="' + src + '" alt="' + name + ' ' + (i+1) + '">' +
      '</button>'
    ).join('');
    const renderDetails = list => !list.length
      ? '<p>Details folgen.</p>'
      : '<ul class="list-disc ml-5 space-y-1">' + list.map(d => '<li>'+d+'</li>').join('') + '</ul>';

    // Markup
    const el = document.getElementById("root");
    el.innerHTML = `
<section class="bg-white rounded-2xl shadow p-5 md:p-6 grid md:grid-cols-2 gap-6 items-start cols-115">
  <div>
    <div class="image-zoom group select-none">
      <img id="heroImg" src="${images[0]}" alt="${product.name}" draggable="false">
      <button id="heroPrev" class="hero-nav left" type="button" aria-label="Vorheriges">‚Äπ</button>
      <button id="heroNext" class="hero-nav right" type="button" aria-label="N√§chstes">‚Ä∫</button>
    </div>
    <div class="thumbs">
      ${renderThumbs(images, product.name)}
    </div>
  </div>

  <div>
    <div class="p-head">
      <h1 class="text-2xl font-extrabold">${product.name}</h1>
      <div class="p-price text-pink-700 font-bold mt-1 text-lg"></div>
    </div>

    <div class="p-tabs mt-6">
      <div class="tabs flex gap-2">
        <button data-tab="tab-desc"    class="tab-btn active">Beschreibung</button>
        <button data-tab="tab-details" class="tab-btn">Zutaten & Infos</button>
        <button data-tab="tab-reviews" class="tab-btn">Bewertungen</button>
      </div>

      <div class="mt-3" id="tab-desc"><p>${desc}</p></div>
      <div class="mt-3 hidden" id="tab-details">${renderDetails(details)}</div>

      <div class="mt-3 hidden" id="tab-reviews">
        <div id="reviewsList" class="space-y-3"></div>
        <form id="reviewForm" class="mt-4 space-y-3 bg-pink-50 p-4 rounded-xl">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <input id="revName" class="border p-2 rounded" placeholder="Dein Name (optional)">
            <select id="revRating" class="border p-2 rounded">
              <option value="5">5 Sterne</option>
              <option value="4">4 Sterne</option>
              <option value="3">3 Sterne</option>
              <option value="2">2 Sterne</option>
              <option value="1">1 Stern</option>
            </select>
          </div>
          <textarea id="revComment" class="border p-2 rounded w-full" rows="3" placeholder="Dein Kommentar"></textarea>
          <button class="btn" type="submit">Absenden</button>
          <p id="revMsg" class="text-sm text-gray-600"></p>
        </form>
      </div>
    </div>

<div class="p-buyrow mt-6 flex items-center gap-3">
  <div class="p-qty qty-wrap">
    <button id="minus" class="qty-btn" type="button" aria-label="Menge verringern">‚àí</button>
    <input id="qty" type="number" min="1" value="1" class="qty-input" />
    <button id="plus" class="qty-btn" type="button" aria-label="Menge erh√∂hen">+</button>
  </div>
  <button id="addBtn" class="btn btn-buy" type="button" aria-label="In den Warenkorb">
    In den Warenkorb
  </button>
</div>
</div>
</section>


<!-- WEITERE PRODUKTE -->
<section class="rel-wrap max-w-7xl mx-auto mt-10" aria-label="Weitere Produkte">
  <div class="rel-head flex items-center justify-between mb-2">
    <h2 id="relTitle" class="rel-animated-title">Weitere Produkte</h2>

    <div class="rel-nav flex gap-2">
      <button id="relPrev" class="rel-btn" type="button" aria-label="Nach links">‚Äπ</button>
      <button id="relNext" class="rel-btn" type="button" aria-label="Nach rechts">‚Ä∫</button>
    </div>
  </div>
  <div class="rel-viewport">
    <div id="relTrack" class="rel-track" role="list"></div>
  </div>

<div id="footer-slot"></div>
`; // <-- footer-slot jetzt INS Template eingef√ºgt (kein JS-Syntaxfehler mehr)

renderRelated(); // <--- DAS HIER EINF√úGEN!

    /* ====== Galerie ====== */
    const heroImg = document.getElementById("heroImg");
    let cur = 0;
    function setHero(i){
      cur = (i + images.length) % images.length;
      heroImg.src = images[cur];
      heroImg.classList.remove('hero-animate'); void heroImg.offsetWidth; heroImg.classList.add('hero-animate');
      el.querySelectorAll(".thumb").forEach(x=>x.classList.toggle("active", +x.dataset.idx===cur));
    }
    el.querySelectorAll(".thumb").forEach(b=> b.addEventListener("click", ()=> setHero(+b.dataset.idx)) );
    document.getElementById("heroPrev").addEventListener("click",(e)=>{ e.stopPropagation(); setHero(cur-1); });
    document.getElementById("heroNext").addEventListener("click",(e)=>{ e.stopPropagation(); setHero(cur+1); });

    // Swipe auf gro√üem Bild + Lightbox-Open
    (function enableSwipe(){
      const hero = heroImg;
      let sx=0, sy=0, moved=false;
      hero.addEventListener("pointerdown", (e)=>{ hero.setPointerCapture(e.pointerId); sx = e.clientX; sy = e.clientY; moved = false; }, { passive: true });
      hero.addEventListener("pointermove", (e)=>{ if(!sx && !sy) return; const dx = e.clientX - sx; const dy = e.clientY - sy;
        if(Math.abs(dx) > 15 && Math.abs(dx) > Math.abs(dy)){ moved = true; e.preventDefault?.(); } }, { passive: false });
      hero.addEventListener("pointerup", (e)=>{ const dx = e.clientX - sx; const dy = e.clientY - sy;
        if(Math.abs(dx) > 60 && Math.abs(dx) > Math.abs(dy)){ if(dx < 0) setHero(cur+1); else setHero(cur-1); } else if(!moved) { openLB(); }
        sx=sy=0; moved=false; }, { passive: true });
    })();

    /* ====== Cart & Tabs ====== */
    const qty = el.querySelector("#qty");
    el.querySelector("#plus").onclick  = ()=> qty.value = String((+qty.value||1)+1);
    el.querySelector("#minus").onclick = ()=> qty.value = String(Math.max(1,(+qty.value||1)-1));
document.getElementById("addBtn").onclick = () => {
  const getCart = () => JSON.parse(localStorage.getItem("mays_cart") || "[]");
  const setCart = v => localStorage.setItem("mays_cart", JSON.stringify(v));
  const refresh = () => {
    const b = document.getElementById("cartBadge");
    if (b) {
      const n = getCart().reduce((s, i) => s + (+i.qty || 0), 0);
      b.textContent = String(n);
    }
  };

  const q = Math.max(1, +qty.value || 1);
  const sel = document.getElementById("packSelect");

  if (!sel || !sel.value) {
    alert("Bitte zuerst eine Packungsgr√∂√üe w√§hlen.");
    return;
  }

  const price = +sel.value;
  const label = sel.selectedOptions[0].textContent.trim();
  const variantId = sel.selectedOptions[0].dataset.id;

const row = {
    id: product.id + "__" + variantId,
    productId: product.id,
    name: `${product.name} (${label})`,
    price: price,
    qty: q,
    variantId: variantId,
    variantLabel: label,
    image: (product.images && product.images[0]) || './images/mays.png'
};


  const cart = getCart();
  const existing = cart.find(x => x.id === row.id);
  if (existing) {
    existing.qty += q;
  } else {
    cart.push(row);
  }

  setCart(cart);
  refresh();
};


    el.querySelectorAll(".tab-btn").forEach(b=>{
      b.addEventListener("click", ()=>{
        el.querySelectorAll(".tab-btn").forEach(x=>x.classList.remove("active"));
        b.classList.add("active");
        const t = b.dataset.tab;
        document.getElementById("tab-desc").classList.toggle("hidden", t!=="tab-desc");
        document.getElementById("tab-details").classList.toggle("hidden", t!=="tab-details");
        document.getElementById("tab-reviews").classList.toggle("hidden", t!=="tab-reviews");
        if(t==="tab-reviews") loadReviews();
      });
    });

    /* ====== Lightbox + Zoom ====== */
    const lb = document.getElementById("lightbox");
    const lbImg = document.getElementById("lbImg");
    const lbStage = document.getElementById("lbStage");
    const lbPrev = document.getElementById("lbPrev");
    const lbNext = document.getElementById("lbNext");
    const lbBox  = document.getElementById("lbBox");
    function onNav(e){ return e.target.closest && e.target.closest('.lb-nav'); }
    function openLB(){
      lb.classList.add("open"); lb.setAttribute("aria-hidden","false");
      setLBImage(cur); resetPanZoom();
      lbBox.classList.remove('lb-open-anim'); void lbBox.offsetWidth; lbBox.classList.add('lb-open-anim');
      updateArrowsLB();
    }
    function closeLB(){ lb.classList.remove("open"); lb.setAttribute("aria-hidden","true"); }
    lb.addEventListener("click",(e)=>{ const insideStage = lbStage.contains(e.target); const isNav = e.target.closest?.('.lb-nav'); if(!insideStage && !isNav) closeLB(); });
    function setLBImage(i){ lbImg.src = images[i]; lbImg.classList.remove("hero-animate"); void lbImg.offsetWidth; lbImg.classList.add("hero-animate"); }

    let scale=1, minS=1, maxS=3, tx=0, ty=0, natW=0, natH=0;
    lbImg.addEventListener('load', ()=>{ natW = lbImg.naturalWidth||0; natH = lbImg.naturalHeight||0; clampPan(); applyTZ(); updateArrowsLB(); });
    function baseSize(){ const W = lbStage.clientWidth, H = lbStage.clientHeight; if(!natW||!natH) return {w:W,h:H}; const a = natW/natH; let w=W, h=W/a; if(h>H){ h=H; w=H*a; } return {w,h}; }
    function clampPan(){ const {w,h}=baseSize(); const scaledW=w*scale, scaledH=h*scale; const maxX=Math.max(0,(scaledW-lbStage.clientWidth)/2); const maxY=Math.max(0,(scaledH-lbStage.clientHeight)/2); tx=Math.max(-maxX,Math.min(maxX,tx)); ty=Math.max(-maxY,Math.min(maxY,ty)); }
    function displaySize(){ const {w,h}=baseSize(); return {w:w*scale,h:h*scale}; }
    function updateArrowsLB(){ const {w}=displaySize(); lbStage.style.setProperty('--imgW', w + 'px'); }
    function applyTZ(){ clampPan(); lbImg.style.transform=`translate(${tx}px,${ty}px) scale(${scale})`; updateArrowsLB(); }
    function resetPanZoom(){ scale=1; tx=0; ty=0; applyTZ(); }
    lbStage.addEventListener("wheel", e=>{ e.preventDefault(); const d=e.deltaY<0?0.12:-0.12; scale=Math.max(minS,Math.min(maxS,scale+d)); if(scale<=1.01){ tx=0; ty=0; } applyTZ(); },{ passive:false });
    lbStage.addEventListener("dblclick",(e)=>{ if(e.target.closest('.lb-nav')) return; scale = (scale>1.01)?1:2; tx=0; ty=0; applyTZ(); });

    // Touch / Pointer in LB
    let startX=null, startY=null, swiping=false;
    let p1=null, p2=null, startDist=0, startScale=1, startTx=0, startTy=0;
    lbStage.addEventListener("pointerdown", e=>{
      if (onNav(e)) return;
      lbStage.setPointerCapture(e.pointerId);
      if (!p1) { p1={id:e.pointerId,x:e.clientX,y:e.clientY}; startX=e.clientX; startY=e.clientY; startTx=tx; startTy=ty; swiping=true; lbImg.classList.add("dragging"); }
      else if (!p2 && e.pointerId!==p1.id){ p2={id:e.pointerId,x:e.clientX,y:e.clientY}; startDist=Math.hypot(p2.x-p1.x,p2.y-p1.y); startScale=scale; swiping=false; }
    });
    lbStage.addEventListener("pointermove", e=>{
      if (onNav(e)) return;
      if(p1 && p1.id===e.pointerId){ p1.x=e.clientX; p1.y=e.clientY; }
      if(p2 && p2.id===e.pointerId){ p2.x=e.clientX; p2.y=e.clientY; }
      if(p1 && p2){ const d=Math.hypot(p2.x-p1.x,p2.y-p1.y)||1; scale=Math.max(minS,Math.min(maxS,startScale*(d/startDist))); applyTZ(); e.preventDefault(); }
      else if(p1){ if(scale>1.01){ tx=startTx+(p1.x-startX); ty=startTy+(p1.y-startY); applyTZ(); e.preventDefault(); } }
    },{ passive:false });
    lbStage.addEventListener("pointerup", e=>{
      if (onNav(e)) return;
      let dx=0, dy=0; if(p1){ dx=p1.x-startX; dy=p1.y-startY; } else { dx=e.clientX-startX; dy=e.clientY-startY; }
      if(swiping && scale<=1.01 && startX!=null && startY!=null){ if(Math.abs(dx)>60 && Math.abs(dx)>Math.abs(dy)){ (dx<0?lbNext:lbPrev).click(); } else if(dy>80 && Math.abs(dy)>Math.abs(dx)){ closeLB(); } }
      if(p2 && e.pointerId===p2.id)p2=null; else if(p1 && e.pointerId===p1.id)p1=null;
      lbImg.classList.remove('dragging'); swiping=false; startX=startY=null;
    });
    lbPrev.onclick = ()=>{ setHero(cur-1); setLBImage(cur); resetPanZoom(); };
    lbNext.onclick = ()=>{ setHero(cur+1); setLBImage(cur); resetPanZoom(); };
    (function hookHeroOpen(){ const hero = heroImg; let moved=false; hero.addEventListener("pointerdown",()=>{ moved=false; }, {passive:true}); hero.addEventListener("pointermove",()=>{ moved=true; }, {passive:true}); hero.addEventListener("pointerup",()=>{ if(!moved) openLB(); }, {passive:true}); })();
    window.addEventListener('resize', ()=>{ if(lb.classList.contains('open')) updateArrowsLB(); });
    document.addEventListener("keydown", (e)=>{ const open = lb && lb.classList.contains("open"); if(!open) return; if(e.key==="ArrowRight") lbNext?.click(); if(e.key==="ArrowLeft") lbPrev?.click(); if(e.key==="Escape") closeLB(); });

    /* ====== Related (Carousel mit Karten) ‚Äì klickbar & stabil ====== */
function renderRelated(){
  const track = document.getElementById('relTrack');
  if(!track || !Array.isArray(PRODUCTS)) return;

  // 1) Auswahl
  const same  = PRODUCTS.filter(p => p && p.available !== false && p.id !== product.id && p.category === product.category);
  const other = PRODUCTS.filter(p => p && p.available !== false && p.id !== product.id && p.category !== product.category);
  const pick  = (arr, n) => arr.slice().sort(()=>Math.random()-0.5).slice(0, n);

  let chosen = pick(same, 10);
  if (chosen.length < 10) chosen = chosen.concat(pick(other, 10 - chosen.length));
  if (!chosen.length){ document.querySelector('.rel-wrap')?.remove(); return; }

  // 2) Helpers
  const fmt  = c => (c/100).toFixed(2).replace('.', ',') + ' ‚Ç¨';
  const priceRange = p => {
    const vs = Array.isArray(p.variants) && p.variants.length
      ? p.variants.slice().sort((a,b)=>a.price-b.price).map(v=>v.price)
      : [1299, 2499]; // Fallback 500g / 1kg
    return vs.length>1 ? `${fmt(vs[0])} ‚Äì ${fmt(vs.at(-1))}` : fmt(vs[0]);
  };
  const variantMin = p => {
    const vs = Array.isArray(p.variants) && p.variants.length
      ? p.variants.slice().sort((a,b)=>a.price-b.price)
      : [{id:'500g', label:'500 g', price:1299}];
    return vs[0];
  };
  const stars = (n=0)=>{
    const full = '‚òÖ'.repeat(Math.max(0,Math.min(5,Math.round(n))));
    const empty= '‚òÜ'.repeat(5-full.length);
    return `<span class="rel-stars" aria-label="${n.toFixed(1)} von 5">${full}${empty}</span>`;
  };

  // 3) Karten (ohne "Details"-Button)
  track.innerHTML = chosen.map(p=>{
    const img = (p.images && p.images[0]) || './images/mays.png';
    const avg = Number(p.ratingAvg || 0);
    const vr  = variantMin(p);
    const href = `./product.html?id=${encodeURIComponent(p.id)}`;
    return `
      <article class="related-card" role="listitem">
        <a class="block card-link" href="${href}" aria-label="${p.name}">
          <div class="rel-img"><img src="${img}" alt="${p.name}"></div>
          <div class="rel-txt">
            <div class="rel-name">${p.name}</div>
            <div class="rel-meta">${p.category || 'Produkt'}</div>
            <div class="rel-price mt-1">${priceRange(p)} <span class="text-gray-400 text-xs">inkl. MwSt.</span></div>
            <div class="mt-1">${stars(avg)}</div>
          </div>
        </a>
        <div class="rel-txt pt-0">
          <button class="btn-mini add-related"
  data-id="${p.id}"
  data-name="${p.name.replace(/"/g,'&quot;')}"
  data-price="${vr.price}"
  data-varid="${vr.id}"
  data-varlabel="${(vr.label||'').replace(/"/g,'&quot;')}"
  data-image="${img}">
  In den Warenkorb
</button>

        </div>
      </article>
    `;
  }).join('');

  // 4) Warenkorb-Buttons
  track.querySelectorAll('.add-related').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      e.preventDefault(); e.stopPropagation();
     const row = {
  id: btn.dataset.id + "_" + btn.dataset.varid,
  productId: btn.dataset.id,
  name: `${btn.dataset.name} (${btn.dataset.varlabel})`,
  price: Number(btn.dataset.price),
  qty: 1,
  variantId: btn.dataset.varid,
  variantLabel: btn.dataset.varlabel,
  image: btn.dataset.image || './images/mays.png'
};

      const getCart=()=>JSON.parse(localStorage.getItem("mays_cart")||"[]");
      const setCart=v=>localStorage.setItem("mays_cart",JSON.stringify(v));
      const cart=getCart();
      const same = cart.find(x=>x.id===row.id && x.variantId===row.variantId);
      if(same) same.qty += 1; else cart.push(row);
      setCart(cart);
      const b=document.getElementById("cartBadge");
      if(b){ const n=cart.reduce((s,i)=>s+(+i.qty||0),0); b.textContent=String(n); }
    });
  });

  // 5) Pfeile + Scroll (mit preventDefault; funktionieren √ºberall)
  const prev = document.getElementById('relPrev');
  const next = document.getElementById('relNext');
  const step = ()=> Math.round(track.clientWidth * 0.9);

  function updateArrows(){
    const atStart = track.scrollLeft <= 2;
    const atEnd   = track.scrollLeft + track.clientWidth >= track.scrollWidth - 2;
    if(prev) prev.disabled = atStart;
    if(next) next.disabled = atEnd;
  }
 if(prev) prev.addEventListener('click', (e)=>{
  e.preventDefault();           // Stoppt Hochspringen
  e.stopPropagation();          // Stoppt Weiterleitung
  track.scrollBy({left:-step(), behavior:'smooth'});
});

if(next) next.addEventListener('click', (e)=>{
  e.preventDefault();
  e.stopPropagation();
  track.scrollBy({left:+step(), behavior:'smooth'});
});

  // 6) Drag-to-scroll, aber Klicks bleiben m√∂glich
  let isDown=false, sx=0, sl=0, moved=false, downLink=null;
  track.addEventListener('pointerdown', e=>{
    isDown=true; moved=false;
    sx=e.clientX; sl=track.scrollLeft;
    downLink = e.target.closest('a');     // merken, ob auf Link gedr√ºckt wurde
    track.setPointerCapture(e.pointerId);
  });
  track.addEventListener('pointermove', e=>{
    if(!isDown) return;
    const dx = e.clientX - sx;
    if(Math.abs(dx) > 3){ moved = true; }
    track.scrollLeft = sl - dx;
    e.preventDefault();
  }, {passive:false});
  track.addEventListener('pointerup', e=>{
    if(!isDown) return;
    isDown=false;
    // wenn kaum bewegt ‚Üí echten Klick auf Link ausf√ºhren
    if(!moved && downLink){
      window.location.href = downLink.href;
    }
    downLink=null; moved=false;
  });
  track.addEventListener('pointerleave',()=>{ isDown=false; downLink=null; moved=false; });

  track.addEventListener('scroll', updateArrows, {passive:true});
  window.addEventListener('resize', updateArrows);
  updateArrows();
}

    /* ====== Packung / Menge ====== */
    (function setupPackungUI(){
      let variants = Array.isArray(product.variants) && product.variants.length
        ? product.variants.slice()
        : [{ id:'500g', label:'500 g', price:1299 }, { id:'1kg',  label:'1 kg',  price:2499 }];
      variants.sort((a,b)=>a.price-b.price);

      const root   = document.getElementById('root');
      const pPrice = root.querySelector('.p-price');
      const buyrow = root.querySelector('.p-buyrow');
      const tabs   = root.querySelector('.p-tabs');

      if (pPrice){
        pPrice.classList.add('price-range');
        pPrice.textContent = variants.length > 1
          ? fmt(variants[0].price) + ' ‚Äì ' + fmt(variants.at(-1).price) + ' ¬∑ inkl. MwSt.'
          : fmt(variants[0].price) + ' ¬∑ inkl. MwSt.';
      }

      buyrow.insertAdjacentHTML('beforebegin',
        '<div id="packRow" class="pack-row pack-row--lg mt-4">'+
          '<span class="pack-label">Packung</span>'+
          '<div class="select-pink select-pink--lg">'+
            '<select id="packSelect" aria-label="Packung w√§hlen">'+
              '<option value="" selected>Bitte w√§hlen ‚Ä¶</option>'+
              variants.map(v=>'<option value="'+v.price+'" data-id="'+v.id+'">'+v.label+'</option>').join('')+
            '</select>'+
          '</div>'+
          '<div id="selPrice" class="pack-price" aria-live="polite" aria-atomic="true"></div>'+
        '</div>'
      );

      const addBtn  = root.querySelector('#addBtn');
      const qtyWrap = root.querySelector('.p-qty');
      addBtn?.classList.add('btn-buy');
      if (addBtn){ addBtn.disabled = true; addBtn.setAttribute('aria-disabled','true'); }

      const sel = root.querySelector('#packSelect');
      const selPrice = root.querySelector('#selPrice');

      sel.addEventListener('change', ()=>{
        if(!sel.value){
          if (addBtn){ addBtn.disabled = true; addBtn.setAttribute('aria-disabled','true'); }
          selPrice.textContent = '';
          if (pPrice){
            pPrice.textContent = variants.length > 1
              ? fmt(variants[0].price) + ' ‚Äì ' + fmt(variants.at(-1).price) + ' ¬∑ inkl. MwSt.'
              : fmt(variants[0].price) + ' ¬∑ inkl. MwSt.';
          }
          return;
        }
        product.price = +sel.value;
        const label = sel.selectedOptions[0].text.trim();
        selPrice.textContent = fmt(product.price) + ' inkl. MwSt.';
        if (pPrice) pPrice.textContent = fmt(product.price) + ' / ' + label + ' ¬∑ inkl. MwSt.';
        if (addBtn){ addBtn.disabled = false; addBtn.removeAttribute('aria-disabled'); }
      });

 // Dropdown-Platz steuern
const packRow = document.getElementById('packRow');
function openSpace(){ packRow?.classList.add('open'); }
function closeSpace(){
  packRow?.classList.remove('open');
  try { sel.blur(); } catch {}
  // Deaktiviert automatisches Springen beim Klicken au√üerhalb
  // setTimeout(()=> packRow?.scrollIntoView({behavior:'smooth', block:'nearest'}), 50);
}
sel.addEventListener('focus', openSpace);
sel.addEventListener('pointerdown', openSpace);
sel.addEventListener('change', closeSpace);
sel.addEventListener('keyup', (e)=>{ if(e.key==='Enter'||e.key==='Escape') closeSpace(); });
document.addEventListener('pointerdown', (e)=>{ if(!packRow.contains(e.target)) closeSpace(); });

      buyrow.insertAdjacentHTML('afterend', '<hr class="section-divider">');
      const divider = buyrow.nextElementSibling;
      if (tabs) divider.after(tabs);
    })();

    /* ====== Init ====== */
    renderRelated();

    // Cart Badge initial
    (function refreshBadge(){
      const getCart=()=>JSON.parse(localStorage.getItem("mays_cart")||"[]");
      const b=document.getElementById("cartBadge");
      if(!b) return;
      const n=getCart().reduce((s,i)=>s+(+i.qty||0),0);
      b.textContent=String(n);
    })();

    /* ===== Bewertungen ===== */
    const productId = id;
    async function loadReviews() {
      const list = document.getElementById("reviewsList");
      if (!list) return;
      list.innerHTML = "<p>Lade Bewertungen...</p>";
      try {
        const res = await fetch("/api/reviews");
        const data = await res.json();
        const filtered = data.filter(r => r.productId === productId);
        if (!filtered.length) { list.innerHTML = "<p>Noch keine Bewertungen.</p>"; return; }
        const avg = filtered.reduce((s, r) => s + Number(r.rating || 0), 0) / filtered.length;
        const avgTxt = `‚≠ê ${avg.toFixed(1)} von 5 (${filtered.length} Bewertungen)`;
        const title = document.querySelector(".p-head h1");
        if (title && !document.getElementById("avgStars")) {
          const span = document.createElement("div");
          span.id = "avgStars";
          span.className = "text-sm text-pink-700 font-semibold mt-1";
          span.textContent = avgTxt;
          title.insertAdjacentElement("afterend", span);
        } else if (title) {
          document.getElementById("avgStars").textContent = avgTxt;
        }
        list.innerHTML = filtered.map(r => `
          <div class="p-3 border border-pink-100 rounded-xl">
            <div class="font-bold text-pink-700 flex justify-between items-center">
              <span>${"‚≠ê".repeat(r.rating)} ‚Äì ${r.name || "Anonym"}</span>
              <span class="text-sm space-x-2">
                <button class="text-pink-500 hover:underline edit-btn" data-id="${r.id}">Bearbeiten</button>
                <button class="text-gray-400 hover:underline delete-btn" data-id="${r.id}">L√∂schen</button>
              </span>
            </div>
            <div class="text-gray-700 mt-1">${r.comment}</div>
            <div class="text-xs text-gray-500 mt-1">${new Date(r.date).toLocaleString()}</div>
          </div>
        `).join("");
        document.querySelectorAll(".edit-btn").forEach(btn => btn.addEventListener("click", () => editReview(btn.dataset.id)));
        document.querySelectorAll(".delete-btn").forEach(btn => btn.addEventListener("click", () => deleteReview(btn.dataset.id)));
      } catch (err) { console.error(err); list.innerHTML = "<p>Fehler beim Laden der Bewertungen.</p>"; }
    }
    function editReview(id) {
      const comment = prompt("Neuer Kommentar:");
      const rating = prompt("Neue Bewertung (1‚Äì5):");
      if (!comment || !rating) return;
      fetch(`/api/reviews/${id}`, { method: "PUT", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ comment, rating: Number(rating) }) })
        .then(() => loadReviews()).catch(() => alert("Fehler beim Bearbeiten"));
    }
    function deleteReview(id) {
      if (!confirm("Willst du diese Bewertung wirklich l√∂schen?")) return;
      fetch(`/api/reviews/${id}`, { method: "DELETE" })
        .then(() => loadReviews()).catch(() => alert("Fehler beim L√∂schen"));
    }
    document.getElementById("reviewForm")?.addEventListener("submit", async e => {
      e.preventDefault();
      const name = document.getElementById("revName").value.trim();
      const rating = +document.getElementById("revRating").value;
      const comment = document.getElementById("revComment").value.trim();
      const msg = document.getElementById("revMsg");
      if (!comment) { msg.textContent = "Bitte einen Kommentar eingeben."; return; }
      try {
        const res = await fetch("/api/reviews", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ productId, name, rating, comment }) });
        if (res.ok) { msg.textContent = "Danke f√ºr deine Bewertung!"; document.getElementById("reviewForm").reset(); loadReviews(); }
        else { msg.textContent = "Fehler beim Senden."; }
      } catch { msg.textContent = "Server nicht erreichbar."; }
    });
  })();
  </script>

  <!-- Keyboard-Fallback f√ºr LB -->
  <script>
    document.addEventListener("keydown", (e)=>{
      const lb = document.getElementById("lightbox");
      const lbNext = document.getElementById("lbNext");
      const lbPrev = document.getElementById("lbPrev");
      if(!lb || !lb.classList.contains("open")) return;
      if(e.key==="ArrowRight") lbNext?.click();
      if(e.key==="ArrowLeft")  lbPrev?.click();
      if(e.key==="Escape")     lb.classList.remove("open");
    });
  </script>
  <script>
  (async () => {
    try {
      const res = await fetch('./footer.html', { cache: 'no-cache' });
      if (!res.ok) throw new Error('Footer not found');
      const html = await res.text();
      const slot = document.getElementById('footer-slot');
      if (slot) slot.outerHTML = html;
    } catch (e) {
      console.warn('Footer konnte nicht geladen werden:', e);
    }
  })();
</script>
<!-- ================= FOOTER ================= -->
<footer class="bg-white border-t border-gray-100 mt-16">
  <div class="max-w-7xl mx-auto px-4 py-10 grid sm:grid-cols-3 gap-8 text-sm">

    <div>
      <div class="font-semibold mb-2">Kontakt</div>
      <div>
        WhatsApp:
        <a class="text-pink-600 hover:underline"
           href="https://wa.me/4917677992233" target="_blank">
          0176 77 99 22 33
        </a>
      </div>
      <div>
        E-Mail:
        <a class="text-pink-600 hover:underline"
           href="mailto:Mays_r.s@yahoo.com">
          Mays_r.s@yahoo.com
        </a>
      </div>
    </div>

    <div>
      <div class="font-semibold mb-2">Adresse</div>
      <a class="text-pink-600 hover:underline"
         target="_blank"
         href="https://www.google.com/maps/dir/?api=1&destination=Lagenbeckerstra√üe%20104%2C%2049477%20Ibbenb√ºren">
        Lagenbecker Stra√üe 104<br>
        49477 Ibbenb√ºren
      </a>
      <div class="mt-2 text-gray-600">
        Sommer (Mo‚ÄìSo): 12‚Äì21 Uhr<br>
        Winter (Mo‚ÄìSo): 12‚Äì20 Uhr
      </div>
    </div>

    <div>
      <div class="font-semibold mb-2">Infos</div>
      <nav class="flex flex-wrap gap-3">
        <a class="text-pink-600 hover:underline" href="/ueber-uns.html">√úber uns</a>
        <a class="text-pink-600 hover:underline" href="/faq.html">FAQ</a>
        <a class="text-pink-600 hover:underline" href="/versand.html">Versand & R√ºckgabe</a>
        <a class="text-pink-600 hover:underline" href="/datenschutz.html">Datenschutz</a>
        <a class="text-pink-600 hover:underline" href="/agb.html">AGB</a>
        <a class="text-pink-600 hover:underline" href="/impressum.html">Impressum</a>
        <a class="text-pink-600 hover:underline" href="/presse.html">Presse</a>
      </nav>
    </div>

  </div>

  <div class="text-center text-xs text-gray-500 py-6">
    ¬© 2025 Mays Restaurant & S√º√üspeisen
  </div>
</footer>

<!-- Warenkorb-Badge -->
<script>
  const CART_KEY = "mays_cart";
  const getCart = () => JSON.parse(localStorage.getItem(CART_KEY) || "[]");
  const badge = document.getElementById("cartBadge");
  if (badge) {
    const n = getCart().reduce((s,i)=>s+(+i.qty||0),0);
    badge.textContent = n;
  }
</script>


</body>
</html>
